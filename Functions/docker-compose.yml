services:
  azurite:
    image: mcr.microsoft.com/azure-storage/azurite
    container_name: functions-azurite
    command: azurite --blobHost 0.0.0.0 --queueHost 0.0.0.0 --tableHost 0.0.0.0 --loose
    ports:
      - "10009:10000"
      - "10010:10001"
      - "10011:10002"
    networks:
      - functions-network

  functions:
    build:
      context: .
    image: cloudgames-functions-test
    container_name: functions
    environment:
      - AzureWebJobsStorage=DefaultEndpointsProtocol=http;AccountName=devstoreaccount1;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;BlobEndpoint=http://azurite:10000/devstoreaccount1;QueueEndpoint=http://azurite:10001/devstoreaccount1;TableEndpoint=http://azurite:10002/devstoreaccount1;
      - FUNCTIONS_WORKER_RUNTIME=dotnet-isolated
      - Games__BaseUrl=http://localhost:5002
      - Games__PaymentsCallbackPath=/api/purchases
      - OTLP__Enabled=false
      - OTLP__Endpoint=http://otel-collector:4318
    ports:
      - "7071:80"
    depends_on:
      - azurite
    networks:
      - functions-network

networks:
  functions-network:
    driver: bridge

